---
link: "[23HDU10E](http://acm.hdu.edu.cn/showproblem.php?pid=7387)"
done: true
tags:
  - tree
  - hashing
---

如果不存在 $0$ 权边，我们很难构造出两棵不同的 $T_1$, $T_2$ 使其满足题目中的条件。实际上，我们可以证明这是不可能的。我们将 $T$ 和 $T_2$ 中由 $0$ 权边连通的点集缩成一个点并得到新树 $T'$ 和 $T_2'$。显然，这样做不会影响两点之间的距离，所以 $T'=T_2'$ 是题目要求的一个充分条件。接下来，我们证明其必要性，即通过题目要求推出 $T'=T_2'$。

首先，如果两个点 $u$, $v$ 在 $T'$ 中属于同一个点，那 $u$, $v$ 在 $T_2'$ 中也属于同一个点，反之亦然。这是因为如果 $u$, $v$ 在 $T'$ 中属于同一个点，则在 $T_2'$ 中 $u$, $v$ 的距离也为 $0$。

接下来，我们证明 $T'$ 和 $T_2'$ 的连边情况也相同。我们找到 $T'$ 的直径 $(u,v)$，因为 $T_2'$ 中任意两点的距离与 $T'$ 相同，$(u,v)$ 在 $T_2'$ 中也是一条直径。直径上的结点显然是叶子结点，而对于 $u$，因为 $T'$ 中不存在 $0$ 权边，所以 $u$ 到其他点之间的最小距离唯一，且这个点就是 $T'$ 中唯一与 $u$ 相邻的点。我们在 $T_2'$ 中也可以以相同的方式确定到同一个点，所以 $u$ 及其邻点和邻边权值在 $T'$ 和 $T_2'$ 中相同，删去 $u$ 不会影响 $T'$ 和 $T_2'$ 的相同与否。我们可以用相同的方法继续删点直到只剩下最后一个点，因此 $T'$ 和 $T_2'$ 一定相同。

因此，我们需要改动尽可能少的边使得 $T'=T_2'$。我们只会把非零边改为零边，因为把零边改为非零边不会让答案更优。我们不妨考虑哪些边权可以为非零，我们发现对于一条边 $(u,v)$，令其将 $T_1$ 划分为 $(U,V)$ 两个集合，则 $(u,v)$ 边权可以为非零当且仅当 $T_2$ 中存在另一条边 $(u',v')$，其也将 $T_2$ 划分为 $(U,V)$ 两个集合。我们可以通过构造证明其充分性，其必要性也可以由 $T'=T_2'$ 简单推出。

我们可以用哈希将 $T_2$ 中每条边划分的点集分别求出存入集合，再对 $T_1$ 的每一条边判断 $T_2$ 中是否有边将 $T_2$ 划分成同样的两个集合。