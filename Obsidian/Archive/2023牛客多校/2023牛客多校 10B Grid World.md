---
link: "[23NC10B](https://ac.nowcoder.com/acm/contest/57364/B)"
done: true
tags:
  - construction
---

我们用 $\frac{A|B}{C|D}$ 代表网格图中的一个 $2\times 2$ 的方格。根据题目中的限制条件，我们有：
- $r,c\ge 5$：
	- 对于图中的方格，每个结点都有恰好两条边连向方格中的其他两个点。
- 每个未损坏的结点都和至少三个未损坏的结点相连：
	- 每个结点都在至少一个方格中。
- 对任意两个损坏的结点 $u$, $v$，如果它们不在同一个连通分量里，那么 $u$ 到 $v$ 的最短路长至少为 $5$。
	- 所有方格都互相连通。

所以，我们可以设计一个基于相邻方格的搜索方法。

首先，我们很容易在图中找到一个任意方格 $\frac{A|B}{C|D}$。我们考虑如何从一个方格扩展到周围的方格。

如果形同 $\frac{B|X}{D|Y}$ 的方格存在，那么一定存在恰好一对点 $(X,Y)$ 满足 $X,Y\notin\{A,B,C,D\}$ 且 $(B,X),(D,Y)\in E$，且我们可以在常数时间内找到这对点。我们同样可以在其他三个方向上进行相似的扩展操作。

基于题目中的限制条件，我们一定可以找到每个方格关于初始方格的相对位置。但因为初始方格的方向未知，我们需要尝试在 $r\times c$ 和 $c\times r$ 两个方向上映射每个结点的位置。当我们找到一个合法的映射后，我们可以通过翻转和行列的循环位移找到字典序最小的映射方案。